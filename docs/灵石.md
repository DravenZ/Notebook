### zabbix  

zabbix： 服务器资源监控平台

+ zabbix  应用:

  + grafana(前端展示) + zabbix

  + zabbix本身前端 + 数据库 + 数据收集
  + 不局限于性能测试,可以独立监控硬件资源 + 软件资源
  + 组成有多个
    + 最主要的 zabbix-server    zabbix-agent(收集、安装被测服务器)

```shell
rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm

yum clean all

yum install zabbix-server-mysql zabbix-agent -y

yum install centos-release-scl -y

vim /etc/yum.repos.d/zabbix.repo
[zabbix-frontend]
enable =1


yum install zabbix-web-mysql-scl zabbix-nginx-conf-scl -y 
```



```sh
rpm -Uvh http://dev.mysql.com/get/mysql57-community-release-el7-10.noarch.rpm

yum install mysql-community-server -y

systemctl restart mysqld

vim /etc/my.cnf
# 添加validate_password_policy配置 0（LOW），1（MEDIUM），2（STRONG）
validate_password_policy=0
# 关闭密码策略
validate_password = off
# 设置字符集
[mysqld]
character-set-server=utf8mb4
collation-server=utf8mb4_general_ci
init_connect='SET NAMES utf8mb4'

# 再次重启mysqld
systemctl restart mysqld

```

 

改mysql的root密码

```
grep "password" /var/log/mysqld.log

# 复制密码

mysql -uroot -p回车
黏贴上面复制密码  回车

ALTER USER 'root'@'localhost' IDENTIFIED BY '123456';

# 开启远程访问
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY '123456' WITH GRANT OPTION;
FLUSH PRIVILEGES;
exit;

systemctl restart mysqld
```



```
# 初始化zabbix的数据库
mysql -uroot -p回车
密码：123456

# 创建数据库
create database zabbix character set utf8 collate utf8_bin;

# 创建zabbix账号并赋予权限
create user zabbix@localhost identified by 'zabbix123';
grant all privileges on zabbix.* to zabbix@localhost;
quit;

# 初始化表结构和数据
zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -p zabbix
输入密码： zabbix123
```



修改zabbix_server的配置文件

```
vim /etc/zabbix/zabbix_server.conf
DBPassword=zabbix123
```



修改zabbix前端配置

```
vim /etc/opt/rh/rh-nginx116/nginx/conf.d/zabbix.conf
把第2、3行前面的# 去掉
```

```
vim /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf
listen.acl_users = apache,nginx

# 去掉最后一行前面 ;
#把 时区  Asia/Shanghai
```





集群： 多台机器一起向外提供服务能力

分布式： 分摊发起方的压力，产生更大的压力向服务器发起请求

+ 分布式的配置：
  + 多台机器
  + 有条件：
    + jdk 大版本要一致   `java -version`  大版本号要相同，小版本号可以不相同
    + jmeter版本要一致
    + jmeter的插件要一致
    + 有没有要求操作系统？
      + 没有   可以使用不同操作系统

+ 配置助攻机器：
  + jmeter.properties
    + server_port=自定义一个端口
    + server.rmi.port= 与上面相同的端口
    + server.rmi.ssl.disable=true 不开启加密认证传输
    + ./jmeter-server -Djava.rmi.server.hostname=192.168.86.130

+ 控制机配置
  + jmeter.properties
    + remote_hosts 添加助攻机器ip:端口，多个时，用英文逗号分开
    + server.rmi.ssl.disable=true  
    + mode=Standard  ---使用标准模式，开启之后，才能实时看到助攻机器的数据

总结： 

​	特别注意事项： 

​	1、你用的分布式的局域网不能太大

​	2、我们做分布式，千万千万不要用wifi网络

zabbix

分布式

# 20210719白板

+ 回顾

  + zabbix：

    + selinux权限 
    + nginx配置：nginx默认端口就是 80
    + centos 7 + zabbix + mysql + nginx
      + zabbix： server、agent
        + server： mysql、 fronted前端要能被访问，需要配置nginx，端口80

  + 分布式环境部署

    + 分布式，是分摊我们发起方的压力，要消耗发起方的资源的，助攻机器不能是被测项目机器

    + 前提条件

      + jdk的大版本要一致
      + jmeter的版本要一致 5.1.1   ---本地jmeter打包，传给助攻机器
      + 插件要一致、csv文件要用相对路径
      + 对于操作系统没有要求

    + 操作步骤：

      + 本地jmeter打包，上传到助攻机器上
      + 如果助攻机器是linux机器： 给jmeter的bin文件夹中的文件赋予执行权限
        + 可能在后续使用中，会报证书异常：
          + 原因是因为没有证书，----我们在http代理录制的时候，生成了一个证书
      + 想把 linux机器 作为助攻机器，修改jmeter.properties配置文件为助攻机配置文件，修改之后，这台机器才会成为助攻机器

    + 配置

      + 助攻机器的配置

        + server_port  自定义一个端口 
        + server.rmi.port  和上面一致的端口
        + server.rmi.ssl.disable=true  关闭加密认证传输

        启动助攻机器：./jmeter-server -Djava.rmi.server.hostname=助攻机器的ip

        主控机器上执行  telnet 助攻机器ip 端口  -----检查主控机器和助攻机器网络是否通畅

      + 主控机器的配置

        + jmeter的bin文件夹中的jmeter.properties文件
          + remote_hosts=助攻机器ip:端口
          + server.rmi.ssl.disable=true
          + mode=Standard  开启
          + 保存
        + 启动服务：gui模式

    + 扩展：

      + 1、只要助攻机器是启动的，主控和助攻之间的网络是通畅，那么我们主控是可以给助攻发任何指令
      + 2、主控机器上的脚本发生变化，助攻机器没有变，远程启动助攻机器执行脚本时，时按照最新的主控机器脚本来执行
        + ===助攻机器slave上一切行为，都是安装主控机器的指令执行。
      + 3、有多台机器作为助攻机器时，活跃线程数，多条； 响应时间曲线，是不做任何处理，原样展示；tps曲线，原样展示。
      + 4、CLI命令行模式 -r参数
      + 有一个特别注意：网络

    ==========

    **自己动手 10分**

    